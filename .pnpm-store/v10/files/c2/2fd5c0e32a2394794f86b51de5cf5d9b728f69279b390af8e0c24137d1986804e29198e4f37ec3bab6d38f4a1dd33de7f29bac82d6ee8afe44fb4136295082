{"version":3,"file":"orval.mjs","names":["pkg.name","pkg.version","pkg.description"],"sources":["../../src/bin/orval.ts"],"sourcesContent":["#!/usr/bin/env node\nimport path from 'node:path';\n\nimport { Option, program } from '@commander-js/extra-typings';\nimport {\n  ErrorWithTag,\n  isString,\n  log,\n  logError,\n  OutputClient,\n  OutputMode,\n  startMessage,\n} from '@orval/core';\n\nimport pkg from '../../package.json';\nimport { generateSpec } from '../generate-spec';\nimport { findConfigFile, loadConfigFile } from '../utils/config';\nimport { normalizeOptions } from '../utils/options';\nimport { startWatcher } from '../utils/watcher';\n\nconst orvalMessage = startMessage({\n  name: pkg.name,\n  version: pkg.version,\n  description: pkg.description,\n});\nconst cli = program\n  .name('orval')\n  .description(\n    'Instantly generate TypeScript clients from your OpenAPI specification',\n  )\n  .version(pkg.version);\n\ncli\n  .addOption(\n    new Option('-o, --output <path>', 'output file destination').conflicts([\n      'config',\n      'project',\n    ]),\n  )\n  .addOption(\n    new Option(\n      '-i, --input <path>',\n      'input file (yaml or json openapi specs)',\n    ).conflicts(['config', 'project']),\n  )\n  .addOption(\n    new Option(\n      '-c, --config <path>',\n      'override flags by a config file',\n    ).conflicts(['input', 'output']),\n  )\n  .addOption(\n    new Option(\n      '-p, --project <name...>',\n      'focus one or more projects of the config',\n    ).conflicts(['input', 'output']),\n  )\n  .addOption(\n    new Option('-m, --mode <name>', 'default mode that will be used').choices(\n      Object.values(OutputMode),\n    ),\n  )\n  .option(\n    '-w, --watch [paths...]',\n    'Watch mode, if path is not specified, it watches the input target',\n  )\n  .addOption(\n    new Option('--client <name>', 'default client that will be used').choices(\n      Object.values(OutputClient),\n    ),\n  )\n  .option('--mock', 'activate the mock')\n  .option('--clean [paths...]', 'Clean output directory')\n  .option('--prettier', 'Prettier generated files')\n  .option('--biome', 'biome generated files')\n  .option('--tsconfig <path>', 'path to your tsconfig file')\n  .action(async (options) => {\n    log(orvalMessage);\n\n    if (isString(options.input) && isString(options.output)) {\n      const normalizedOptions = await normalizeOptions({\n        input: options.input,\n        output: {\n          target: options.output,\n          clean: options.clean,\n          prettier: options.prettier,\n          biome: options.biome,\n          mock: options.mock,\n          client: options.client,\n          mode: options.mode,\n          tsconfig: options.tsconfig,\n        },\n      });\n\n      if (options.watch) {\n        await startWatcher(\n          options.watch,\n          async () => {\n            try {\n              await generateSpec(process.cwd(), normalizedOptions);\n            } catch (error) {\n              logError(error);\n              process.exit(1);\n            }\n          },\n          normalizedOptions.input.target as string,\n        );\n      } else {\n        try {\n          await generateSpec(process.cwd(), normalizedOptions);\n        } catch (error) {\n          if (error instanceof ErrorWithTag) {\n            logError(error.cause, error.tag);\n          } else {\n            logError(error);\n          }\n          process.exit(1);\n        }\n      }\n    } else {\n      const configFilePath = findConfigFile(options.config);\n      const workspace = path.dirname(configFilePath);\n      const configFile = await loadConfigFile(configFilePath);\n\n      const missingProjects = options.project?.filter(\n        (p) => !Object.hasOwn(configFile, p),\n      );\n\n      if (missingProjects?.length) {\n        logError(`Project not found in config: ${missingProjects.join(', ')}`);\n        process.exit(1);\n      }\n\n      const configs = Object.entries(configFile).filter(\n        ([projectName]) =>\n          // only filter by project if specified\n          !Array.isArray(options.project) ||\n          options.project.includes(projectName),\n      );\n\n      let hasErrors = false;\n      for (const [projectName, config] of configs) {\n        const normalizedOptions = await normalizeOptions(\n          config,\n          workspace,\n          options,\n        );\n\n        if (options.watch === undefined) {\n          try {\n            await generateSpec(workspace, normalizedOptions, projectName);\n          } catch (error) {\n            hasErrors = true;\n            logError(error, projectName);\n          }\n        } else {\n          const fileToWatch = isString(normalizedOptions.input.target)\n            ? normalizedOptions.input.target\n            : undefined;\n\n          await startWatcher(\n            options.watch,\n            async () => {\n              try {\n                await generateSpec(workspace, normalizedOptions, projectName);\n              } catch (error) {\n                logError(error, projectName);\n              }\n            },\n            fileToWatch,\n          );\n        }\n      }\n\n      if (hasErrors) {\n        logError('One or more project failed, see above for details');\n        process.exit(1);\n      }\n    }\n  });\n\nawait cli.parseAsync(process.argv);\n"],"mappings":"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"}